project:
  key: PEGASUS
  name: Pegasus
  plans:
    - key: BNT49
      name: Build & Test (master)
      scm:
        - !git
          name: Pegasus
          url: https://github.com/pegasus-isi/pegasus.git
          branch: master
      stages:
        - name: Source Checkout
          jobs:
            - key: DIST
              name: Source checkout and distribution
              description: Create the full distribution tarball
              tasks:
                - !checkout
                  description: Checks the Pegasus code out from our source repository
                  forceCleanBuild: true
                  repositories:
                    - name: Pegasus
                      checkoutDirectory: pegasus-source
                - !script
                  description: Create source tarballs
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      pwd
                      ls -la

                      VERSION=`pegasus-source/release-tools/getversion`

                      # Make sure it is clean
                      (cd pegasus-source && ant clean)

                      # We need a versioned copy to put on the website that
                      # excludes git files, but include the generated docs
                      (cd pegasus-source && ant dist-source swamp-tarballs && mv dist/pegasus-$VERSION.tar.gz dist/pegasus-swamp*-$VERSION.tar.gz ..)

                      # pegasus-source.tar.gz is a tarball which is used to in subsequent buildsteps
                      # make this a copy of the generated source tarball to keep everyhing
                      # consistent
                      (cd pegasus-source/dist && tar xzf ../../pegasus-$VERSION.tar.gz && mv pegasus-$VERSION pegasus-source && tar -czf ../../pegasus-source.tar.gz pegasus-source && rm -rf pegasus-source)

                      # Create the source tarball for python source files using setup.py
                      (cd pegasus-source && ant dist-python-source && mv dist/pegasus-python-source-$VERSION.tar.gz ..)

              artifactDefinitions:
                - name: pegasus-python-source-versioned
                  copyPattern: 'pegasus-python-source-*.tar.gz'
                  isShared: true
                - name: pegasus-source-versioned
                  copyPattern: 'pegasus-?.*.tar.gz'
                  isShared: true
                - name: pegasus-source-versioned-swamp-c
                  copyPattern: 'pegasus-swamp-c-?.*.tar.gz'
                  isShared: true
                - name: pegasus-source-versioned-swamp-java
                  copyPattern: 'pegasus-swamp-java-?.*.tar.gz'
                  isShared: true
                - name: pegasus-source-versioned-swamp-python
                  copyPattern: 'pegasus-swamp-python-?.*.tar.gz'
                  isShared: true
                - name: pegasus-source
                  copyPattern: 'pegasus-source.tar.gz'
                  isShared: true
              requirements:
                - capabilityKey: docbuild
                  matchType: !equals
                    matchValue: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true

        - name: Unit Tests
          description: Run Unit Tests on Code and Binaries
          jobs:
            - key: D9CUT
              name: Debian 9 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_9}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} test-kickstart test-pmc test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D9JUT
              name: Debian 9 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_9}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-java
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D9PUT
              name: Debian 9 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_9}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-python
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D10CUT
              name: Debian 10 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_10}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} test-kickstart test-pmc test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D10JUT
              name: Debian 10 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_10}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-java
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: D10PUT
              name: Debian 10 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_10}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-python
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: OCUT
              name: OSX Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      # We need /usr/local/bin because of homebrew
                      export PATH=$PATH:/usr/local/bin:/Library/TeX/texbin
                      cd pegasus-source
                      ant test-kickstart test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: platform
                  matchType: !equals
                    matchValue: macos
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key:  R6CUT
              name: RHEL 6 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_CENTOS_6}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} test-kickstart test-pmc test-transfer
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R6JUT
              name: RHEL 6 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_CENTOS_6}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-java
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R6PUT
              name: RHEL 6 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_CENTOS_6}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-python
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R7CUT
              name: RHEL 7 Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_CENTOS_7}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} test-kickstart test-pmc test-transfer test-integrity
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R7JUT
              name: RHEL 7 Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_CENTOS_7}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-java
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: R7PUT
              name: RHEL 7 Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_CENTOS_7}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-python
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTCUZ
              name: Ubuntu Zesty Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_17}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} test-kickstart test-pmc test-transfer test-integrity
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTJUZ
              name: Ubuntu Zesty Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_17}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-java
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTPUZ
              name: Ubuntu Zesty Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_17}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-python
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTCUB
              name: Ubuntu Bionic Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_18}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} test-kickstart test-pmc test-transfer test-integrity
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTJUB
              name: Ubuntu Bionic Java Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Java Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_18}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-java
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: UTPUB
              name: Ubuntu Bionic Python Unit Tests
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Python Unit Tests
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_18}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --entrypoint ant \
                      --env "USER=bamboo" \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      pegasus/pegasus:${TAG} test-python
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true

        - name: Build
          description: Build Pegasus
          jobs:
            - key: DOCGEN
              name: Build Docs
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Build Documentation
                  taskConfig:
                    label: Ant
                    target: dist-doc
                    buildJdk: JDK
                    workingSubDirectory: pegasus-source
              artifactDefinitions:
                - name: pegasus-doc
                  copyPattern: 'pegasus-doc-*.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: docbuild
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BR
              name: Build R
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Build R DAX Package
                  taskConfig:
                    label: Ant
                    target: dist-r
                    buildJdk: JDK
                    workingSubDirectory: pegasus-source
              artifactDefinitions:
                - name: pegasus-r-dax3
                  copyPattern: 'pegasus-r-dax3*.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: docbuild
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXR632
              name: Build x86 RHEL 6
              enabled: false
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Binary Packages
                  taskConfig:
                    label: Ant
                    target: dist-rpm dist-worker dist-release
                    buildJdk: JDK
                    workingSubDirectory: pegasus-source
              artifactDefinitions:
                - name: pegasus-binary-x86_rhel_6
                  copyPattern: 'pegasus-binary-*-x86_rhel_6.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-rpm-x86_rhel_6
                  copyPattern: 'pegasus-*i?86.rpm'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_rhel_6
                  copyPattern: 'pegasus-worker-*-x86_rhel_6.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: arch
                  matchType: !equals
                    matchValue: x86
                - capabilityKey: platform
                  matchType: !equals
                    matchValue: rhel
                - capabilityKey: release
                  matchType: !matches
                    regex: 6.*
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXR6
              name: Build x86_64 RHEL 6
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_CENTOS_6}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} \
                      dist-rpm dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_rhel_6
                  copyPattern: 'pegasus-binary-*-x86_64_rhel_6.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-rpm-x86_64_rhel_6
                  copyPattern: '*x86_64.rpm'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-srcrpm
                  copyPattern: '*.src.rpm'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_rhel_6
                  copyPattern: 'pegasus-worker-*-x86_64_rhel_6.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXR7
              name: Build x86_64 RHEL 7
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_CENTOS_7}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} \
                      dist-rpm dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_rhel_7
                  copyPattern: 'pegasus-binary-*-x86_64_rhel_7.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-rpm-x86_64_rhel_7
                  copyPattern: '*x86_64.rpm'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_rhel_7
                  copyPattern: 'pegasus-worker-*-x86_64_rhel_7.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXDJ
              name: Build x86_64 Debian 8
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_8}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} \
                      clean dist-deb dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_deb_8
                  copyPattern: 'pegasus-binary-*-x86_64_deb_8.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_deb_8
                  copyPattern: '*.deb'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_deb_8
                  copyPattern: 'pegasus-worker-*-x86_64_deb_8.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXDS
              name: Build x86_64 Debian 9
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_9}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} \
                      clean dist-deb dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_deb_9
                  copyPattern: 'pegasus-binary-*-x86_64_deb_9.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_deb_9
                  copyPattern: '*.deb'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_deb_9
                  copyPattern: 'pegasus-worker-*-x86_64_deb_9.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BDEB10
              name: Build x86_64 Debian 10
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_DEBIAN_10}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} \
                      clean dist-deb dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_deb_10
                  copyPattern: 'pegasus-binary-*-x86_64_deb_10.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_deb_10
                  copyPattern: '*.deb'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_deb_10
                  copyPattern: 'pegasus-worker-*-x86_64_deb_10.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXOSX
              name: Build x86_64 OSX
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Binary Packages
                  taskConfig:
                    label: Ant
                    environmentVariables: "PATH=${PATH}:/usr/local/bin:/Library/TeX/texbin"
                    target: dist-worker dist-release dist-macos
                    buildJdk: JDK
                    workingSubDirectory: pegasus-source
              artifactDefinitions:
                - name: pegasus-binary-x86_64_macos
                  copyPattern: 'pegasus-binary-*.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-dmg-x86_64_macos
                  copyPattern: '*.dmg'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_macos
                  copyPattern: 'pegasus-worker-*.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: arch
                  matchType: !equals
                    matchValue: x86_64
                - capabilityKey: platform
                  matchType: !equals
                    matchValue: macos
                - capabilityKey: release
                  matchType: !matches
                    regex: 10.*
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXUX
              name: Build x86_64 Ubuntu Xenial
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_16}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} \
                      clean dist-deb dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_ubuntu_16
                  copyPattern: 'pegasus-binary-*-x86_64_ubuntu_16.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_ubuntu_16
                  copyPattern: '*.deb'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_ubuntu_16
                  copyPattern: 'pegasus-worker-*-x86_64_ubuntu_16.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXUZ
              name: Build x86_64 Ubuntu Zesty
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_17}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} \
                      clean dist-deb dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_ubuntu_17
                  copyPattern: 'pegasus-binary-*-x86_64_ubuntu_17.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_ubuntu_17
                  copyPattern: '*.deb'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_ubuntu_17
                  copyPattern: 'pegasus-worker-*-x86_64_ubuntu_17.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: BXUB
              name: Build x86_64 Ubuntu 18.04 LTS
              tasks:
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xzf pegasus-source.tar.gz"
                - !script
                  description: Binary Packages
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      TAG=${bamboo_TAG_UBUNTU_18}

                      /opt/docker/docker-bamboo-wrapper pull pegasus/pegasus:${TAG}

                      /opt/docker/docker-bamboo-wrapper run \
                      --rm \
                      --volume ${bamboo_build_working_directory}/pegasus-source:/home/bamboo/pegasus-source \
                      --entrypoint ant \
                      pegasus/pegasus:${TAG} \
                      clean dist-deb dist-worker dist-release
              artifactDefinitions:
                - name: pegasus-binary-x86_64_ubuntu_18
                  copyPattern: 'pegasus-binary-*-x86_64_ubuntu_18.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-deb-x86_64_ubuntu_18
                  copyPattern: '*.deb'
                  location: pegasus-source/dist
                  isShared: true
                - name: pegasus-worker-x86_64_ubuntu_18
                  copyPattern: 'pegasus-worker-*-x86_64_ubuntu_18.tar.gz'
                  location: pegasus-source/dist
                  isShared: true
              artifactDependencies:
                - name: pegasus-source
              requirements:
                - capabilityKey: system.docker.executable
                  matchType: !exists exists
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true

        - name: Deploy
          description: Deploy Artifacts
          jobs:
            - key: DA
              name: Deploy Artifacts
              tasks:
                - !script
                  description: Organize artifacts for upload
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      echo
                      echo "Available artifacts are:"
                      ls -lh
                      echo

                      tar xzf pegasus-source.tar.gz
                      VERSION=`./pegasus-source/release-tools/getversion`
                      if [ "X$VERSION" = "X" ]; then
                          echo "Unable to determine Pegasus version! Exiting..."
                          exit 1
                      fi

                      mkdir -p docs
                      tar xzf pegasus-doc-*.tar.gz -C docs

                      DOWNLOADS=pegasus/$VERSION
                      mkdir -p $DOWNLOADS
                      mv pegasus-4*.tar.gz $DOWNLOADS/
                      mv pegasus-swamp-*.tar.gz $DOWNLOADS/
                      mv pegasus-python-source-*.tar.gz $DOWNLOADS/
                      mv pegasus-binary-*.tar.gz $DOWNLOADS/
                      mv pegasus-worker-*.tar.gz $DOWNLOADS/
                      mv pegasus-doc-*.tar.gz $DOWNLOADS/
                      mv *.deb $DOWNLOADS/
                      mv *.rpm $DOWNLOADS/
                      mv *.dmg $DOWNLOADS/
                      mv pegasus-r-dax3*.tar.gz $DOWNLOADS/

                      # debian
                      mkdir -p $DOWNLOADS/debian/dists/jessie/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*deb8_amd64.deb $DOWNLOADS/debian/dists/jessie/main/binary-amd64/
                      mkdir -p $DOWNLOADS/debian/dists/stretch/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*deb9_amd64.deb $DOWNLOADS/debian/dists/stretch/main/binary-amd64/
                      mkdir -p $DOWNLOADS/debian/dists/buster/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*deb10_amd64.deb $DOWNLOADS/debian/dists/buster/main/binary-amd64/

                      # ubuntu
                      mkdir -p $DOWNLOADS/ubuntu/dists/xenial/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*ubuntu16_amd64.deb $DOWNLOADS/ubuntu/dists/xenial/main/binary-amd64/
                      mkdir -p $DOWNLOADS/ubuntu/dists/zesty/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*ubuntu17_amd64.deb $DOWNLOADS/ubuntu/dists/zesty/main/binary-amd64/
                      mkdir -p $DOWNLOADS/ubuntu/dists/bionic/main/binary-amd64
                      cp $DOWNLOADS/pegasus_*ubuntu18_amd64.deb $DOWNLOADS/ubuntu/dists/bionic/main/binary-amd64/

                      # rheh
                      mkdir -p $DOWNLOADS/rhel/src
                      cp $DOWNLOADS/pegasus-*.src.rpm $DOWNLOADS/rhel/src/
                      mkdir -p $DOWNLOADS/rhel/6/x86_64
                      cp $DOWNLOADS/pegasus-*el6.x86_64.rpm $DOWNLOADS/rhel/6/x86_64/
                      mkdir -p $DOWNLOADS/rhel/7/x86_64
                      cp $DOWNLOADS/pegasus-*el7.x86_64.rpm $DOWNLOADS/rhel/7/x86_64/

                      # standard filenames for RPMs - used by tutorial VM
                      cd pegasus/$VERSION
                      if [ ! -e pegasus-$VERSION-1.el6.x86_64.rpm ]; then
                          cp pegasus-*el6.x86_64.rpm pegasus-$VERSION-1.el6.x86_64.rpm
                      fi
                      if [ ! -e pegasus-$VERSION-1.el7.x86_64.rpm ]; then
                          cp pegasus-*el7.x86_64.rpm pegasus-$VERSION-1.el7.x86_64.rpm
                      fi
                      cd ../..

                      # no files should be left behind
                      ls -l

                      scp -r $DOWNLOADS download.pegasus.isi.edu:/srv/download.pegasus.isi.edu/public_html/pegasus/

                      # new wordpress site
                      ssh pegasus.isi.edu "mkdir -p /srv/pegasus.isi.edu/public_html/docs/$VERSION"
                      scp -r docs/pegasus-*/share/doc/pegasus/wordpress/* pegasus.isi.edu:/srv/pegasus.isi.edu/public_html/docs/$VERSION/
              artifactDependencies:
                - name: pegasus-binary-x86_64_deb_8
                - name: pegasus-binary-x86_64_deb_9
                - name: pegasus-binary-x86_64_deb_10
                - name: pegasus-binary-x86_64_macos
                - name: pegasus-binary-x86_64_rhel_6
                - name: pegasus-binary-x86_64_rhel_7
                - name: pegasus-binary-x86_64_ubuntu_16
                - name: pegasus-binary-x86_64_ubuntu_17
                - name: pegasus-binary-x86_64_ubuntu_18
                #- name: pegasus-binary-x86_rhel_6
                - name: pegasus-deb-x86_64_deb_8
                - name: pegasus-deb-x86_64_deb_9
                - name: pegasus-deb-x86_64_deb_10
                - name: pegasus-deb-x86_64_ubuntu_16
                - name: pegasus-deb-x86_64_ubuntu_17
                - name: pegasus-deb-x86_64_ubuntu_18
                - name: pegasus-dmg-x86_64_macos
                - name: pegasus-doc
                - name: pegasus-python-source-versioned
                - name: pegasus-r-dax3
                - name: pegasus-rpm-x86_64_rhel_6
                - name: pegasus-rpm-x86_64_rhel_7
                #- name: pegasus-rpm-x86_rhel_6
                - name: pegasus-source
                - name: pegasus-source-versioned
                - name: pegasus-source-versioned-swamp-c
                - name: pegasus-source-versioned-swamp-java
                - name: pegasus-source-versioned-swamp-python
                - name: pegasus-srcrpm
                - name: pegasus-worker-x86_64_deb_8
                - name: pegasus-worker-x86_64_deb_9
                - name: pegasus-worker-x86_64_deb_10
                - name: pegasus-worker-x86_64_macos
                - name: pegasus-worker-x86_64_rhel_6
                - name: pegasus-worker-x86_64_rhel_7
                - name: pegasus-worker-x86_64_ubuntu_16
                - name: pegasus-worker-x86_64_ubuntu_17
                - name: pegasus-worker-x86_64_ubuntu_18
                #- name: pegasus-worker-x86_rhel_6
              requirements:
                - capabilityKey: hostname
                  matchType: !equals
                    matchValue: build-1.pegasus.isi.edu
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
      permissions:
        user:
          mayani:
            -  !permission ADMIN
        group:
          ccg-users:
            -  !permission VIEW
            -  !permission BUILD
        other:
          !userType ANONYMOUS_USERS:
            -  !permission VIEW
          !userType LOGGED_IN_USERS:
            -  !permission VIEW
      triggers:
        - !scheduled
          description: Nightly Build
          cronExpression: "0 0 21 * * ?"
      notifications:
        - !email
          address: pegasus-svn@isi.edu
          event: !event JOB_HUNG
        - !email
          address: pegasus-svn@isi.edu
          event: !event FAILED_BUILDS_AND_FIRST_SUCCESSFUL
      variables:
        - key: TAG_CENTOS_6
          value: centos6
        - key: TAG_CENTOS_7
          value: centos7
        - key: TAG_DEBIAN_8
          value: jessie
        - key: TAG_DEBIAN_9
          value: stretch
        - key: TAG_DEBIAN_10
          value: buster
        - key: TAG_UBUNTU_16
          value: xenial
        - key: TAG_UBUNTU_17
          value: zesty
        - key: TAG_UBUNTU_18
          value: bionic

    - key: TVM49
      name: Tutorial VM (master)
      scm:
        - !git
          name: Pegasus
          url: https://github.com/pegasus-isi/pegasus.git
          branch: master
      stages:
        - name: Build Tutorial VM
          description: Build Tutorial VM
          jobs:
            - key: TV
              name: Tutorial VM
              description: Generate Pegasus Tutorial VMs for VirtualBox and AWS EC2.
              tasks:
                - !checkout
                  description: Checks the Pegasus code out from our source repository
                  forceCleanBuild: true
                  repositories:
                    - name: Pegasus
                - !script
                  description: Build and Deploy VM
                  environmentVariables: PATH=/usr/local/bin
                  workingSubDirectory: release-tools/tutorial_vm
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      export PACKER_CACHE_DIR=~/.packer_cache
                      VERSION=`../getversion`

                      if [ "$USER" == "root" ]; then
                          echo "ERROR: Bamboo agent running as root! Restart as user 'bamboo'"
                          exit 1
                      fi

                      PACKER_LOG=1 ./build-vm.sh "${VERSION}"
                - !script
                  description: Cleanup
                  isFinal: true
                  environmentVariables: PATH=/usr/local/bin
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      VERSION=`release-tools/getversion`

                      echo "#################################################"
                      echo "Cleanup, ignore errors reported beyond this point"
                      echo "#################################################"

                      VBoxManage controlvm    "pegasus-tutorial-base-vm-${VERSION}" poweroff
                      VBoxManage discardstate "pegasus-tutorial-base-vm-${VERSION}"
                      VBoxManage unregistervm --delete "pegasus-tutorial-base-vm-${VERSION}"

                      VBoxManage controlvm    "PegasusTutorialVM-${VERSION}" poweroff
                      VBoxManage discardstate "PegasusTutorialVM-${VERSION}"
                      VBoxManage unregistervm --delete "PegasusTutorialVM-${VERSION}"

                      rm -rf ~/VirtualBox\ VMs/{pegasus-tutorial-base-vm-${VERSION},"PegasusTutorialVM-${VERSION}"}

                      exit 0
              requirements:
                - capabilityKey: awscli.installed
                  matchType: !equals
                    matchValue: 'true'
                - capabilityKey: system.builder.command.packer
                  matchType: !exists exists
                - capabilityKey: virtualbox.installed
                  matchType: !equals
                    matchValue: 'true'
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
      permissions:
        user:
          mayani:
            -  !permission ADMIN
        group:
          ccg-users:
            -  !permission VIEW
            -  !permission BUILD
        other:
          !userType ANONYMOUS_USERS:
            -  !permission VIEW
          !userType LOGGED_IN_USERS:
            -  !permission VIEW
      triggers:
        - !scheduled
          description: Nightly Build
          cronExpression: "0 0 20 * * ?"
          onlyRunIfOtherPlansArePassing:
            planKeys:
              - PEGASUS-BNT49
      notifications:
        - !email
          address: pegasus-svn@isi.edu
          event: !event JOB_HUNG
        - !email
          address: pegasus-svn@isi.edu
          event: !event FAILED_BUILDS_AND_FIRST_SUCCESSFUL

    - key: WT49
      name: Workflow Tests (master)
      scm:
        - !git
          name: Pegasus
          url: https://github.com/pegasus-isi/pegasus.git
          branch: master
      stages:
        - name: Setup
          description: Setup
          jobs:
            - key: BP
              name: Build Pegasus
              description: Build Pegasus
              tasks:
                - !checkout
                  description: Checks the Pegasus code out from our source repository
                  forceCleanBuild: true
                  repositories:
                    - name: Pegasus
                - !customTask
                  pluginKey: com.atlassian.bamboo.plugins.ant:task.builder.ant
                  description: Binary Packages
                  taskConfig:
                    label: Ant
                    environmentVariables: "PATH=/usr/lib64/mpich/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin"
                    target: clean dist-worker dist-common compile-pmc
                    buildJdk: JDK
                - !script
                  description: Install Binaries
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      TARGET_DIR=/lizard/scratch-90-days/bamboo/installs

                      NAME=`cd dist && ls | grep -v tar | grep pegasus`
                      echo "Found $NAME"

                      mkdir -p $TARGET_DIR
                      rm -rf $TARGET_DIR/$NAME
                      cp -r dist/$NAME $TARGET_DIR
                - !script
                  description: Create Test Tarball
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      set -e
                      set -x

                      rm -f tests.tar
                      tar cf tests.tar test/
                      cd dist
                      mv pegasus-*/ pegasus

                      # Later on we need to include the worker package
                      #tar rf ../tests.tar pegasus/ pegasus-worker-*.tar.gz
                      tar rf ../tests.tar pegasus/
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDefinitions:
                - name: tests
                  copyPattern: 'tests.tar'
                  isShared: true
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false

        - name: Workflow Tests
          description: Workflow Tests
          jobs:
            - key: CHECKENV
              name: 000-check-env
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf /scitech/home/bamboo/.pegasus/workflow.db"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: T1
              name: 001-black-diamond-vanilla-condor
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4N6
              name: 004-montage-condor-io
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4
              name: 004-montage-grid
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4M1
              name: 004-montage-shared-fs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: SC004MON
              name: 004-montage-shared-fs-sc
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4N12
              name: 004-montage-staging-site
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T4M2
              name: 004-montage-universe-local
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T005
              name: 005-galactic-plane
              description: TODO
              enabled: false
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T6
              name: 006-black-diamond-shell-code-generator
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-status ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T7
              name: 007-black-diamond-pegasuslite-local
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T8
              name: 008-black-diamond-pegasuslite-condorio
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T9
              name: 009-black-diamond-pegasuslite-pegasustransfer
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T9A
              name: 009-black-diamond-pegasuslite-pegasustransfer-a
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T10A
              name: 010-runtime-clustering - CondorIO
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test 010-runtime-clustering runtime-condorio
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T10B
              name: 010-runtime-clustering - Non-SharedFS
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test 010-runtime-clustering runtime-nonsharedfs
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T10C
              name: 010-runtime-clustering - SharedFS
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test 010-runtime-clustering runtime-sharedfs
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T10D
              name: 010-runtime-clustering SharedFS Staging and No Kickstart
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test 010-runtime-clustering runtime-sharedfs-all-staging-nogridstart
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T11
              name: 011-rosetta-staging-site
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T12
              name: 012-blackdiamond-invoke
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: TESTMPIDAG
              name: 013-pegasus-mpi-cluster
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  environmentVariables: "PATH=/usr/lib64/mpich/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin"
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T15
              name: 015-shell-hierarchic-workflow
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-status ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T016
              name: 016-pegasus-transfer
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: T18A
              name: 018-black-condorc-condor-io
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T18C
              name: 018-black-condorc-hybrid
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T18B
              name: 018-black-condorc-staging-site
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T19A
              name: 019-black-label
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: PMCONLY
              name: 020-pmc-only
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  environmentVariables: "PATH=/usr/lib64/mpich/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin"
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-status ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T21A
              name: 021-black-dir
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: BNT22A
              name: 022-data-reuse-full-a
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: BNT022B
              name: 022-data-reuse-full-b
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T22
              name: 022-data-reuse-regexrc
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T023
              name: 023-sc4-ssh-http
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T024
              name: 024-sc4-gridftp-http
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T025
              name: 025-sc4-file-http
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T26
              name: 026-cache-url-check
              description: TODO
              enabled: true
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T27A
              name: 027-montage-bypass-staging-site
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T27B
              name: 027-montage-bypass-staging-site-condorio
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T28A
              name: 028-dynamic-hierarchy
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T028B
              name: 028-dynamic-hierarchy-b
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T29A
              name: 029-black-quiet
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: PEG030GS
              name: 030-pegasuslite-gs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: PEG030
              name: 030-pegasuslite-irods
              description: TODO
              enabled: false
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: PEG030S3
              name: 030-pegasuslite-s3
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: SSHFTP030
              name: 030-pegasuslite-sshftp
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: RC031MON
              name: 031-montage-condor-io-jdbcrc
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T31A
              name: 031-montage-jdbcrc-sqlite
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T32A
              name: 032-black-chkpoint
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T33
              name: 033-pegasuslite-multi
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T33A
              name: 033-pegasuslite-multi-wp-a
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T33B
              name: 033-pegasuslite-multi-wp-b
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T33C
              name: 033-pegasuslite-multi-wp-c
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T34C
              name: 034-recursive-cluster-condorio
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T34B
              name: 034-recursive-cluster-nonsharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T34A
              name: 034-recursive-cluster-sharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T35
              name: 035-black-transfer
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T36
              name: 036-condorio-no-outputs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T37
              name: 037-black-hints
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T038
              name: 038-halt-continue
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T39A
              name: 039-black-metadata
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T040N1
              name: 040-multiple-input-sources-nonsharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T040N2
              name: 040-multiple-input-sources-sharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T042B
              name: 042-kswrapper-nonsharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T042A
              name: 042-kswrapper-sharedfs
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043A
              name: 043-integrity-condorio
              description: Integrity checking on for the whole workflow
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043B
              name: 043-integrity-nonsharedfs
              description: Integrity checking with nonsharedfs
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T043SYN
              name: 043-integrity-synthetic-with-errors
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: true
            - key: T044A
              name: 044-docker-nonsharedfs
              description: nonsharedfs test with docker containers and executable staging
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044B
              name: 044-docker-nonsharedfs-shared
              description: Docker in nonsharedfs with a shared filesystem
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044C
              name: 044-singularity-nonsharedfs
              description: Singularity nonsharedfs case
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044D
              name: 044-singularity-nonsharedfs-shared
              description: Singularity test case
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T044E
              name: 044-singularity-nonsharedfs-hub
              description: Singularity test case, using shub images
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T045A
              name: 045-hierarchy-sharedfs
              description: Baseline hierarchal workflow
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T045B
              name: 045-hierarchy-sharedfs-b
              description: Baseline hierarchal workflow in sharedfs and worker package staging turned on
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T046A
              name: 046-aws-batch-black
              description: Blackdiamond workflow with horizontal clustering and clusters run on AWS Batch
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1D
              name: blackdiamond - pl-condorio
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond pl-condorio
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1B
              name: blackdiamond - pl-condorio-local
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond pl-condorio-local
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1E
              name: blackdiamond - pl-pt
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond pl-pt
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1C
              name: blackdiamond - pl-pt-local
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond pl-pt-local
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1F
              name: blackdiamond - sharedfs-symlink-nogridstart
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond sharedfs-symlink-nogridstart
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1G
              name: blackdiamond - sharedfs-worker-staging-cleanup
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond sharedfs-worker-staging-cleanup
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T1A
              name: blackdiamond - vanilla-condor
              description: TODO
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test blackdiamond vanilla-condor
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false

        - name: Performance Tests
          description: Performance Tests
          jobs:
            - key: T014
              name: 014-planner-performance
              description: Planner performance
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T014100K
              name: 014-planner-performance-100k
              description: Planner performance 100K
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T014C
              name: 014-planner-performance-ahope
              description: A LIGO ahope test case with Shell code generator
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: T014HCC
              name: 014-planner-performance-hcc
              description: Planner performance HCC
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-planner-only ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
            - key: JDBCPERF
              name: 041-jdbcrc-performance
              description: JDBC RC performance
              tasks:
                - !script
                  description: Cleanup
                  enabled: true
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "rm -rf pegasus/ test/"
                - !script
                  description: Untar source
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: "tar xf tests.tar"
                - !script
                  description: Run Test
                  inlineScript:
                    interpreter: !scriptInterpreter LEGACY_SH_BAT
                    scriptBody: |
                      export PATH=${bamboo_build_working_directory}/pegasus/bin:$PATH
                      test/scripts/launch-bamboo-test-no-jobs ${bamboo_shortJobName}
              requirements:
                - capabilityKey: condor
                  matchType: !exists exists
                - capabilityKey: performance
                  matchType: !exists exists
              artifactDependencies:
                - name: tests
              miscellaneous:
                cleanWorkingDirectoryAfterEachBuild: false
      permissions:
        user:
          mayani:
            -  !permission ADMIN
        group:
          ccg-users:
            -  !permission VIEW
            -  !permission BUILD
        other:
          !userType ANONYMOUS_USERS:
            -  !permission VIEW
          !userType LOGGED_IN_USERS:
            -  !permission VIEW
      triggers:
        - !scheduled
          description: Nightly Build
          cronExpression: "0 0 1 * * ?"
          onlyRunIfOtherPlansArePassing:
            planKeys:
              - PEGASUS-BNT49
      notifications:
        - !email
          address: pegasus-svn@isi.edu
          event: !event JOB_HUNG
        - !email
          address: pegasus-svn@isi.edu
          event: !event FAILED_BUILDS_AND_FIRST_SUCCESSFUL
